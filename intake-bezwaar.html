<script>
document.getElementById("bezwaarForm").addEventListener("submit", e=>{
  e.preventDefault();

  const result = document.getElementById("apiResult");
  result.innerHTML = "⏳ Dossier wordt aangemaakt...";

  const f = e.target;
  const file = document.getElementById("boeteFile").files[0];
  if(!file){
    result.innerHTML="❌ Geen bestand geselecteerd";
    return;
  }

  const r = new FileReader();

  r.onload = async ()=>{
    const data = Object.fromEntries(new FormData(f));
    data.filename = file.name;
    data.mimetype = file.type;
    data.filedata = r.result.split(",")[1];

    try{
      const res = await fetch("<script>
document.getElementById("bezwaarForm").addEventListener("submit", e=>{
  e.preventDefault();

  const result = document.getElementById("apiResult");
  result.innerHTML = "⏳ Dossier wordt aangemaakt...";

  const f = e.target;
  const file = document.getElementById("boeteFile").files[0];
  if(!file){
    result.innerHTML="❌ Geen bestand geselecteerd";
    return;
  }

  const r = new FileReader();

  r.onload = async ()=>{
    const data = Object.fromEntries(new FormData(f));
    data.filename = file.name;
    data.mimetype = file.type;
    data.filedata = r.result.split(",")[1];

    try{
      const res = await fetch("https://script.google.com/macros/s/AKfycbwJMnrWBwhh5bg-7EVRWpZKqVgGTO5rDi9xqI1VhyMGE75bL3RTm9HzhbD1kpmMXEkW6A/exec",{
        method:"POST",
        body:JSON.stringify(data)
      });

      const txt = await res.text();
      result.innerHTML = txt.startsWith("OK|")
        ? "✅ Dossier aangemaakt: <b>"+txt.split("|")[1]+"</b>"
        : "❌ " + txt;

    }catch(err){
      result.innerHTML="❌ Verbindingsfout";
    }
  };

  r.readAsDataURL(file);
});
</script>
,{
        method:"POST",
        body:JSON.stringify(data)
      });

      const txt = await res.text();
      result.innerHTML = txt.startsWith("OK|")
        ? "✅ Dossier aangemaakt: <b>"+txt.split("|")[1]+"</b>"
        : "❌ " + txt;

    }catch(err){
      result.innerHTML="❌ Verbindingsfout";
    }
  };

  r.readAsDataURL(file);
});
</script>

